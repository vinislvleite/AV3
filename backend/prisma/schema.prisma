generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Aeronave {
  codigo      Int           @id
  modelo      String
  tipo        TipoAeronave
  capacidade  Int
  alcance     Int
  cliente     String
  dataEntrega String

  pecas       Peca[]
  etapas      EtapaProducao[]
  testes      Teste[]
  relatorios  Relatorio[]

  @@map("aeronaves")
}

model Funcionario {
  id             Int                @id @default(autoincrement())
  nome           String
  telefone       String
  endereco       String
  usuario        String             @unique
  senha          String
  nivelPermissao Permissao

  etapas         EtapaFuncionario[]

  @@map("funcionarios")
}

model Peca {
  id         Int        @id @default(autoincrement())
  nome       String
  tipo       TipoPeca
  fornecedor String
  status     StatusPeca

  aeronaveId Int
  aeronave   Aeronave   @relation(fields: [aeronaveId], references: [codigo], onDelete: Cascade)

  @@map("pecas")
}

model EtapaProducao {
  id             Int               @id @default(autoincrement())
  nome           String
  prazoConclusao DateTime
  status         Int               @default(0)

  aeronaveId     Int
  aeronave       Aeronave          @relation(fields: [aeronaveId], references: [codigo], onDelete: Cascade)

  funcionarios   EtapaFuncionario[]

  @@map("etapas_producao")
}

model Teste {
  id         Int            @id @default(autoincrement())
  nome       String
  tipo       TipoTeste
  resultado  ResultadoTeste
  aeronaveId Int
  aeronave   Aeronave       @relation(fields: [aeronaveId], references: [codigo], onDelete: Cascade)

  @@map("testes")
}

model Relatorio {
  id          Int      @id @default(autoincrement())
  data        DateTime @default(now())

  aeronaveId  Int
  aeronave    Aeronave @relation(fields: [aeronaveId], references: [codigo], onDelete: Cascade)

  @@map("relatorios")
}

model EtapaFuncionario {
  etapaId       Int
  funcionarioId Int

  etapa         EtapaProducao @relation(fields: [etapaId], references: [id], onDelete: Cascade)
  funcionario   Funcionario   @relation(fields: [funcionarioId], references: [id], onDelete: Cascade)

  @@id([etapaId, funcionarioId])
  @@map("etapas_funcionarios")
}

enum TipoAeronave {
  MILITAR   @map("militar")
  COMERCIAL @map("comercial")
}

enum TipoPeca {
  NACIONAL  @map("nacional")
  IMPORTADA @map("importada")
}

enum StatusPeca {
  EM_PRODUCAO   @map("em producao")
  EM_TRANSPORTE @map("em transporte")
  PRONTA        @map("pronta para uso")
}

enum TipoTeste {
  ELETRICO     @map("eletrico")
  HIDRAULICO   @map("hidraulico")
  AERODINAMICO @map("aerodinamico")
}

enum ResultadoTeste {
  APROVADO  @map("aprovado")
  REPROVADO @map("reprovado")
}

enum Permissao {
  ADMINISTRADOR @map("administrador")
  ENGENHEIRO    @map("engenheiro")
  OPERADOR      @map("operador")
}